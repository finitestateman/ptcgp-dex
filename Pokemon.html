<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>포켓몬 입력폼</title>
</head>

<body>
    <h1>포켓몬 정보 입력</h1>
    <form id="pokemonForm">
        <div>
            <label for="dexNo">Dex No:</label>
            <input type="number" id="dexNo" name="dexNo" required>
        </div>
        <div>
            <label for="identifier">Identifier:</label>
            <input type="text" id="identifier" name="identifier" required>
        </div>
        <div>
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div>
            <label for="species">Species:</label>
            <input type="text" id="species" name="species" required>
        </div>
        <div>
            <label for="type1">Type1:</label>
            <select id="type1" name="type1" required>
                <option value="">선택하세요</option>
                <option value="grass">grass</option>
                <option value="fire">fire</option>
                <option value="water">water</option>
                <option value="lightning">lightning</option>
                <option value="psychic">psychic</option>
                <option value="fighting">fighting</option>
                <option value="darkness">darkness</option>
                <option value="metal">metal</option>
                <option value="dragon">dragon</option>
                <option value="colorless">colorless</option>
            </select>
        </div>
        <div>
            <label for="type2">Type2:</label>
            <select id="type2" name="type2">
                <option value="">선택 안 함</option>
                <option value="grass">grass</option>
                <option value="fire">fire</option>
                <option value="water">water</option>
                <option value="lightning">lightning</option>
                <option value="psychic">psychic</option>
                <option value="fighting">fighting</option>
                <option value="darkness">darkness</option>
                <option value="metal">metal</option>
                <option value="dragon">dragon</option>
                <option value="colorless">colorless</option>
            </select>
        </div>
        <div>
            <label for="height">Height:</label>
            <input type="number" id="height" name="height" required>
        </div>
        <div>
            <label for="weight">Weight:</label>
            <input type="number" id="weight" name="weight" required>
        </div>
        <div>
            <label for="introducedGen">Introduced Gen:</label>
            <input type="number" id="introducedGen" name="introducedGen" required>
        </div>
        <div>
            <label for="descriptionContent">Description Content:</label>
            <textarea id="descriptionContent" name="descriptionContent" required></textarea>
        </div>
        <button type="submit">전송</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // 기존에 저장된 데이터가 있으면 불러오기
            const savedData = JSON.parse(localStorage.getItem("pokemonFormData"));
            if (savedData) {
                Object.keys(savedData).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = savedData[key];
                });
            }
        });

        document.getElementById("pokemonForm").addEventListener("input", () => {
            // 입력값이 변경될 때마다 localStorage에 저장
            const formData = {
                dexNo: document.getElementById("dexNo").value,
                identifier: document.getElementById("identifier").value,
                name: document.getElementById("name").value,
                species: document.getElementById("species").value,
                type1: document.getElementById("type1").value,
                type2: document.getElementById("type2").value,
                height: document.getElementById("height").value,
                weight: document.getElementById("weight").value,
                introducedGen: document.getElementById("introducedGen").value,
                descriptionContent: document.getElementById("descriptionContent").value
            };
            localStorage.setItem("pokemonFormData", JSON.stringify(formData));
        });

        document.getElementById("pokemonForm").addEventListener("submit", async function (event) {
            event.preventDefault(); // 폼 기본 제출 이벤트 중지

            const payload = {
                dexNo: Number(document.getElementById("dexNo").value),
                identifier: document.getElementById("identifier").value,
                name: document.getElementById("name").value,
                species: document.getElementById("species").value + " Pokémon",
                type1: document.getElementById("type1").value,
                type2: document.getElementById("type2").value || null, // type2가 선택되지 않으면 null
                height: Number(document.getElementById("height").value),
                weight: Number(document.getElementById("weight").value),
                introducedGen: Number(document.getElementById("introducedGen").value),
                description: {
                    content: document.getElementById("descriptionContent").value
                }
            };

            try {
                const response = await fetch("http://localhost:3000/pokemons", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error("서버 응답이 정상적이지 않습니다.");
                }

                const data = await response.json();
                console.log("서버 응답:", data);
                alert("데이터가 성공적으로 전송되었습니다.");
                localStorage.removeItem("pokemonFormData"); // 성공하면 데이터 삭제
            } catch (error) {
                console.error("전송 에러:", error);
                alert("데이터 전송 중 오류가 발생했습니다. 폼 내용을 유지합니다.");
            }
        });
    </script>
</body>

</html>